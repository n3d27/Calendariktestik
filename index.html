<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ближайшие дни рождения</title>
<style>
  body { font-family:sans-serif; margin:20px; background:#f7f7fb; }
  h1 { font-size:20px; margin-bottom:10px; }
  form { margin-bottom:15px; display:flex; gap:6px; flex-wrap:wrap; align-items:center; }
  input, button { padding:6px; border-radius:6px; border:1px solid #ccc; }
  button { background:#2b6cb0; color:#fff; border:0; cursor:pointer; }
  ul { list-style:none; padding:0; }
  li { background:#fff; padding:8px; margin-bottom:6px; border-radius:6px; box-shadow:0 1px 3px rgba(0,0,0,0.1); display:flex; justify-content:space-between; align-items:center; }
  .del { background:#f44336; color:#fff; border:0; padding:2px 6px; border-radius:4px; cursor:pointer; }
  .today { background:#c8e6c9; } /* зелёный */
  .soon { background:#fff9c4; }  /* жёлтый */
</style>
</head>
<body>

<h1>Ближайшие дни рождения</h1>

<form id="birthdayForm">
  <input type="text" id="name" placeholder="Имя" required>
  <input type="date" id="date" required>
  <button type="submit">Добавить</button>
</form>

<ul id="birthdayList"></ul>

<script>
const form = document.getElementById('birthdayForm');
const list = document.getElementById('birthdayList');

let birthdays = JSON.parse(localStorage.getItem('birthdays') || '[]');

function pad(n){ return n<10?'0'+n:n; }

function save(){ localStorage.setItem('birthdays', JSON.stringify(birthdays)); }

function formatDate(dateStr){
  const d = new Date(dateStr);
  return `${pad(d.getDate())}-${pad(d.getMonth()+1)}-${d.getFullYear()}`;
}

function getNextOccurrence(d){
  const today = new Date();
  let next = new Date(today.getFullYear(), d.getMonth(), d.getDate());
  if(next < today) next.setFullYear(today.getFullYear()+1);
  return next;
}

function render(){
  list.innerHTML='';
  const today = new Date();
  const sorted = birthdays.map(b=>{
    const d = new Date(b.date);
    const next = getNextOccurrence(d);
    const diffDays = Math.ceil((next - today)/(24*3600*1000));
    return {...b, nextDate: next, diffDays};
  }).sort((a,b)=>a.diffDays - b.diffDays);

  if(!sorted.length){
    list.innerHTML='<li>Нет данных</li>';
    return;
  }

  sorted.forEach(b=>{
    const li = document.createElement('li');
    li.innerHTML = `<span>${b.name} — ${formatDate(b.date)} (через ${b.diffDays} дн)</span>`;
    const del = document.createElement('button');
    del.textContent='Удалить';
    del.className='del';
    del.onclick=()=>{
      birthdays = birthdays.filter(x=>x!==b);
      save(); render();
    };
    li.appendChild(del);

    // Подсветка
    if(b.diffDays === 0) li.classList.add('today');
    else if(b.diffDays <= 7) li.classList.add('soon');

    list.appendChild(li);
  });
}

form.onsubmit = e=>{
  e.preventDefault();
  const name = form.name.value.trim();
  const dateStr = form.date.value;
  if(!name || !dateStr) return;
  birthdays.push({name, date: dateStr});
  save();
  form.reset();
  render();
}

render();
</script>

</body>
</html>
